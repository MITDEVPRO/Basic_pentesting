from scapy.all import sniff
import pandas as pd

# Lista para almacenar los datos de los paquetes
packet_data = []

def packet_callback(packet):
    try:
        # Verificar si el paquete tiene las capas necesarias
        if packet.haslayer('IP') and packet.haslayer('TCP'):
            # Extraer las direcciones IP de origen y destino
            src_ip = packet['IP'].src
            dst_ip = packet['IP'].dst

            # Agregar los datos del paquete a la lista
            packet_data.append({'Source IP': src_ip, 'Destination IP': dst_ip})

        else:
            print("El paquete no contiene las capas IP y TCP necesarias.")

    except Exception as e:
        print(f"Ocurrió un error: {e}")

if __name__ == "__main__":
    print("Capturando paquetes...")
    # Capturar los paquetes
    sniff(prn=packet_callback, count=10, iface="en0")  # Especifica tu interfaz aquí
    
    # Convertir la lista de datos de los paquetes en un DataFrame de pandas
    df = pd.DataFrame(packet_data)
    
    # Mostrar la tabla en la consola
    print(df)
